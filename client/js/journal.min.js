function drawJournalList(){$("#journal-list option").remove();var t="";for(var e in journal_data)if(!($.inArray(e+"",selected_journals)>-1)){var l=journal_data[e],r=l.count?l.count:0;t+="<option value='"+e+"'>"+l.title+" ("+r+")</option>"}$("#journal-list").append(t)}function drawSelectedJournals(){for(var t=0;t<selected_journals.length;t++)if(!($("#journal-filter li[journal-id='"+selected_journals[t]+"']").length>0)){var e=selected_journals[t],l=journal[selected_journals[t]],r="<li class='filter-item' journal-id='"+e+"'><span class='filter-legend'       style='background-color:"+color_scale(e)+";'></span>"+l.title+" ("+l.count+")      <span class='filter-close'       onclick='removeJournalFilter(this)'>x</span></li>";$("ul#journal-filter").append(r)}$(".filter-item").on("mouseover",function(){var t=$(this).attr("journal-id"),e=d3.selectAll("svg[journal-id='"+t+"']");e.selectAll("circle").style("stroke",rgb_highlight).style("z-index",999),e.each(function(t){d3.selectAll("svg.links[doc-target='"+t.documentid+"']").selectAll("line").style("stroke",rgb_highlight).style("z-index",999),d3.selectAll("svg.links[doc-source='"+t.documentid+"']").selectAll("line").style("stroke",rgb_highlight).style("z-index",999)})}),$(".filter-item").on("mouseout",function(){var t=$(this).attr("journal-id"),e=d3.selectAll("svg[journal-id='"+t+"']");e.selectAll("circle").style("stroke",rgb_highlight).style("z-index","auto"),e.each(function(t){d3.selectAll("svg.links[doc-target='"+t.documentid+"']").selectAll("line").style("stroke",rgb_stroke).style("z-index","auto"),d3.selectAll("svg.links[doc-source='"+t.documentid+"']").selectAll("line").style("stroke",rgb_stroke).style("z-index","auto")})})}function removeJournalFilter(t){var e=$(t).parent(),l=e.attr("journal-id");e.remove(),selected_journals=selected_journals.filter(function(t){return t!=l}),applyFilters(!0)}function filterAuthors(t,e){selected_authors=selected_authors.concat($("select#author-list").val());var l=[],r=$.grep(t.documents,function(t,e){return $.inArray(t.journalid+"",selected_journals)>-1&&(-1==$.inArray(t.entityid+"",l)&&l.push(t.entityid),!0)}),a={};for(var n in l)a[l[n]]=t.entities[l[n]];for(var o={documents:r,entities:a},i=0;i<selected_authors.length;i++)$("#author-list option[value='"+selected_authors[i]+"']").remove();if(e)return o;update(o)}function filterJournals(t,e){selected_journals=selected_journals.concat($("select#journal-list").val());var l=[],r=$.grep(t.documents,function(t,e){return $.inArray(t.journalid+"",selected_journals)>-1&&(-1==$.inArray(t.entityid+"",l)&&l.push(t.entityid),!0)}),a={};for(var n in l)a[l[n]]=t.entities[l[n]];for(var o={documents:r,entities:a},i=0;i<selected_journals.length;i++)$("#journal-list option[value='"+selected_journals[i]+"']").remove();if(e)return o;update(o)}function applyFilters(t){clearOverlay(),filter_data=filterJournals(map_data,!0),drawJournalList(),filter_data=filterAuthors(filter_data,!0);var e=filter_data.documents?filter_data.documents:[];author_data=extractAuthorList(e),drawAuthorList(),t&&drawSelectedJournals(),update(filter_data)}function clearOverlay(){for(;overlays.length>0;)overlays.pop().setMap(null)}function extractJournalList(t){var e=[];journal_data={};for(var l=0;l<t.length;l++){var r=t[l].journalid;e.includes(r)||(e.push(r),journal_data[r]=journal[r])}drawJournalList()}function extractAuthorList(t){for(var e=[],l={},r=0;r<t.length;r++){var a=t[r].authorid;e.includes(a)?l[a].count+=1:(e.push(a),l[a]={},l[a].name=t[r].author,l[a].count=1)}return l}function drawAuthorList(){$("#author-list option").remove();var t="";for(var e in author_data)if(!($.inArray(e+"",selected_authors)>-1)){var l=author_data[e],r=l.count?l.count:0;t+="<option value='"+e+"'>"+l.name+" ("+r+")</option>"}$("#author-list").append(t)}var journal={},journal_data={},author_data={},selected_journals=[],selected_authors=[];d3.json("/journal",function(t,e){journal=e});