function drawJournalList(){$("#journal-list option").remove();for(var l="",e=0;e<journal_data.length;e++)$.inArray(journal_data[e].id+"",selected_journals)>-1||(l+="<option value='"+journal_data[e].id+"'>"+journal_data[e].title+" ("+(journal_data[e].count?journal_data[e].count:0)+")</option>");$("#journal-list").append(l)}function drawSelectedJournals(){for(var l=0;l<selected_journals.length;l++)if(!($("#journal-filter li[journal-id='"+selected_journals[l]+"']").length>0)){var e=getJournal(selected_journals[l]),t="<li class='filter-item' journal-id='"+e.id+"'><span class='filter-legend'       style='background-color:"+color_scale(e.id)+";'></span>"+e.title+" ("+e.count+")      <span class='filter-close'       onclick='removeJournalFilter(this)'>x</span></li>";$("ul#journal-filter").append(t)}$(".filter-item").on("mouseover",function(){var l=$(this).attr("journal-id"),e=d3.selectAll("svg[journal-id='"+l+"']");e.selectAll("circle").style("stroke",rgb_highlight).style("z-index",999),e.each(function(l){d3.selectAll("svg.links[doc-target='"+l.documentid+"']").selectAll("line").style("stroke",rgb_highlight).style("z-index",999),d3.selectAll("svg.links[doc-source='"+l.documentid+"']").selectAll("line").style("stroke",rgb_highlight).style("z-index",999)})}),$(".filter-item").on("mouseout",function(){var l=$(this).attr("journal-id"),e=d3.selectAll("svg[journal-id='"+l+"']");e.selectAll("circle").style("stroke",rgb_highlight).style("z-index","auto"),e.each(function(l){d3.selectAll("svg.links[doc-target='"+l.documentid+"']").selectAll("line").style("stroke",rgb_stroke).style("z-index","auto"),d3.selectAll("svg.links[doc-source='"+l.documentid+"']").selectAll("line").style("stroke",rgb_stroke).style("z-index","auto")})})}function showJournalLinks(l){$("svg.marker[journal-id='"+l+"']").each(function(){$("svg.links[doc-source='"+$(this).attr("doc-id")+"']").each(function(){showLinks($(this).attr("doc-target"))})})}function removeJournalFilter(l){var e=$(l).parent(),t=e.attr("journal-id");e.remove(),selected_journals=selected_journals.filter(function(l){return l!=t}),filterJournals(!1),drawJournalList()}function filterJournals(l){for(;overlays.length>0;)overlays.pop().setMap(null);selected_journals=selected_journals.concat($("select#journal-list").val());for(var e=[],t=$.grep(map_data.documents,function(l,t){return $.inArray(l.journalid+"",selected_journals)>-1&&(e.push(l.documentid),!0)}),n=[],a=0;a<map_data.links.length;a++)$.inArray(map_data.links[a].source,e)>-1&&$.inArray(map_data.links[a].target,e)>-1&&n.push(map_data.links[a]);var r={documents:t,links:n};update(r),l&&drawSelectedJournals();for(a=0;a<selected_journals.length;a++)$("#journal-list option[value='"+selected_journals[a]+"']").remove()}function getJournal(l){for(var e=0;e<journal_data.length;e++)if(l==journal_data[e].id)return journal_data[e];return{id:"",title:""}}var journal_data={},selected_journals=[];d3.json("/journal",function(l,e){journal_data=e});