function drawJournalList(){$("#journal-list option").remove();var e="";for(var t in journal_data)if(!($.inArray(t+"",selected_journals)>-1)){var l=journal_data[t],r=l.count?l.count:0;e+="<option value='"+t+"'>"+l.title+" ("+r+")</option>"}$("#journal-list").append(e)}function drawSelectedJournals(){for(var e=0;e<selected_journals.length;e++)if(!($("#journal-filter li[journal-id='"+selected_journals[e]+"']").length>0)){var t=selected_journals[e],l=journal[selected_journals[e]],r="<li class='filter-item' journal-id='"+t+"'><span class='filter-legend'       style='background-color:"+color_scale(t)+";'></span>"+l.title+" ("+l.count+")      <span class='filter-close'       onclick='removeJournalFilter(this)'>x</span></li>";$("ul#journal-filter").append(r)}highlightJournal()}function highlightJournal(){$(".filter-item").on("mouseover",function(){var e=$(this).attr("journal-id"),t=d3.selectAll("svg[journal-id='"+e+"']");t.selectAll("circle").style("stroke",rgb_highlight).style("z-index",999),t.each(function(e){d3.selectAll("svg.links[doc-target='"+e.documentid+"']").selectAll("line").style("stroke",rgb_highlight).style("z-index",999),d3.selectAll("svg.links[doc-source='"+e.documentid+"']").selectAll("line").style("stroke",rgb_highlight).style("z-index",999)})}),$(".filter-item").on("mouseout",function(){var e=$(this).attr("journal-id"),t=d3.selectAll("svg[journal-id='"+e+"']");t.selectAll("circle").style("stroke",rgb_highlight).style("z-index","auto"),t.each(function(e){d3.selectAll("svg.links[doc-target='"+e.documentid+"']").selectAll("line").style("stroke",rgb_stroke).style("z-index","auto"),d3.selectAll("svg.links[doc-source='"+e.documentid+"']").selectAll("line").style("stroke",rgb_stroke).style("z-index","auto")})})}function removeJournalFilter(e){var t=$(e).parent(),l=t.attr("journal-id");t.remove(),selected_journals=selected_journals.filter(function(e){return e!=l}),applyFilters(!0)}function filterJournals(e,t){if(0==(selected_journals=selected_journals.concat($("select#journal-list").val())).length)return e;var l=[],r=$.grep(e.documents,function(e,t){return $.inArray(e.journalid+"",selected_journals)>-1&&(-1==$.inArray(e.entityid+"",l)&&l.push(e.entityid),!0)}),a={};for(var o in l)a[l[o]]=e.entities[l[o]];for(var n={documents:r,entities:a},s=0;s<selected_journals.length;s++)$("#journal-list option[value='"+selected_journals[s]+"']").remove();if(t)return n;update(n)}function applyFilters(e){clearOverlay(),filter_data=filterJournals(map_data,!0),drawJournalList(),filter_data=filterAuthors(filter_data,!0);var t=filter_data.documents?filter_data.documents:[];author_data=extractAuthorList(t),drawAuthorList(),e&&(drawSelectedJournals(),drawSelectedAuthors()),update(filter_data)}function clearOverlay(){for(;overlays.length>0;)overlays.pop().setMap(null)}function extractJournalList(e){var t=[];journal_data={};for(var l=0;l<e.length;l++){var r=e[l].journalid;t.includes(r)||(t.push(r),journal_data[r]=journal[r])}drawJournalList()}function removeAuthorFilter(e){var t=$(e).parent(),l=t.attr("author-id");t.remove(),selected_authors=selected_authors.filter(function(e){return e!=l}),applyFilters(!0)}function filterAuthors(e,t){if(0==(selected_authors=selected_authors.concat($("select#author-list").val())).length)return e;var l=[],r=$.grep(e.documents,function(e,t){return $.inArray(e.authorid+"",selected_authors)>-1&&(-1==$.inArray(e.entityid+"",l)&&l.push(e.entityid),!0)}),a={};for(var o in l)a[l[o]]=e.entities[l[o]];for(var n={documents:r,entities:a},s=0;s<selected_authors.length;s++)$("#author-list option[value='"+selected_authors[s]+"']").remove();if(t)return n;update(n)}function drawSelectedJournals(){for(var e=0;e<selected_journals.length;e++)if(!($("#journal-filter li[journal-id='"+selected_journals[e]+"']").length>0)){var t=selected_journals[e],l=journal[selected_journals[e]],r="<li class='filter-item' journal-id='"+t+"'><span class='filter-legend'       style='background-color:"+color_scale(t)+";'></span>"+l.title+" ("+l.count+")      <span class='filter-close'       onclick='removeJournalFilter(this)'>x</span></li>";$("ul#journal-filter").append(r)}highlightJournal()}function drawSelectedAuthors(){for(var e=0;e<selected_authors.length;e++)if(!($("#author-filter li[author-id='"+selected_authors[e]+"']").length>0)){var t=selected_authors[e],l=author_data[selected_authors[e]],r="<li class='filter-item' author-id='"+t+"'><span class='filter-legend'       style='background-color:"+color_scale(t)+";'></span>"+l.name+" ("+l.count+")      <span class='filter-close'       onclick='removeAuthorFilter(this)'>x</span></li>";$("ul#author-filter").append(r)}}function extractAuthorList(e){for(var t=[],l={},r=0;r<e.length;r++){var a=e[r].authorid;t.includes(a)?l[a].count+=1:(t.push(a),l[a]={},l[a].name=e[r].author,l[a].count=1)}return l}function drawAuthorList(){$("#author-list option").remove();var e="";for(var t in author_data)if(!($.inArray(t+"",selected_authors)>-1)){var l=author_data[t],r=l.count?l.count:0;e+="<option value='"+t+"'>"+l.name+" ("+r+")</option>"}$("#author-list").append(e)}var journal={},journal_data={},author_data={},selected_journals=[],selected_authors=[];d3.json("/journal",function(e,t){journal=t});