function drawJournalList(){$("#journal-widget").remove();for(var e="<div id='journal-widget' class='tool-box-widget'>    <h2>Journals</h2>    <select id='journal-list' size='10' multiple>",l=0;l<journal_data.length;l++)$.inArray(journal_data[l].id+"",selected_journals)>-1||(e+="<option value='"+journal_data[l].id+"'>"+journal_data[l].title+" ("+(journal_data[l].count?journal_data[l].count:0)+")</option>");e+="</select><div class='ui vertical segment right aligned'>    <button onclick='filterJournals(true);'>Add Journals</button>    </div></div>",$("#tool-box").append(e)}function drawSelectedJournals(){for(var e=0;e<selected_journals.length;e++)if(!($("#journal-filter li[journal-id='"+selected_journals[e]+"']").length>0)){var l=getJournal(selected_journals[e]),t="<li class='filter-item' journal-id='"+l.id+"'>"+l.title+"<span class='filter-close'       onclick='removeJournalFilter(this)'>x</span></li>";$("ul#journal-filter").append(t)}$(".filter-item").on("mouseover",function(){var e=$(this).attr("journal-id"),l=d3.selectAll("svg[journal-id='"+e+"']");l.selectAll("circle").style("stroke",rgb_highlight).style("z-index",999),l.each(function(e){d3.selectAll("svg.links[doc-target='"+e.documentid+"']").selectAll("line").style("stroke",rgb_highlight).style("z-index",999),d3.selectAll("svg.links[doc-source='"+e.documentid+"']").selectAll("line").style("stroke",rgb_highlight).style("z-index",999)})}),$(".filter-item").on("mouseout",function(){var e=$(this).attr("journal-id"),l=d3.selectAll("svg[journal-id='"+e+"']");l.selectAll("circle").style("stroke",rgb_highlight).style("z-index","auto"),l.each(function(e){d3.selectAll("svg.links[doc-target='"+e.documentid+"']").selectAll("line").style("stroke",rgb_stroke).style("z-index","auto"),d3.selectAll("svg.links[doc-source='"+e.documentid+"']").selectAll("line").style("stroke",rgb_stroke).style("z-index","auto")})})}function showJournalLinks(e){$("svg.marker[journal-id='"+e+"']").each(function(){$("svg.links[doc-source='"+$(this).attr("doc-id")+"']").each(function(){showLinks($(this).attr("doc-target"))})})}function removeJournalFilter(e){var l=$(e).parent(),t=l.attr("journal-id");l.remove(),selected_journals=selected_journals.filter(function(e){return e!=t}),filterJournals(!1),drawJournalList()}function filterJournals(e){for(;overlays.length>0;)overlays.pop().setMap(null);selected_journals=selected_journals.concat($("select#journal-list").val());for(var l=[],t=$.grep(map_data.documents,function(e,t){return $.inArray(e.journalid+"",selected_journals)>-1&&(l.push(e.documentid),!0)}),n=[],r=0;r<map_data.links.length;r++)$.inArray(map_data.links[r].source,l)>-1&&$.inArray(map_data.links[r].target,l)>-1&&n.push(map_data.links[r]);var a={documents:t,links:n};update(a),e&&drawSelectedJournals();for(r=0;r<selected_journals.length;r++)$("#journal-list option[value='"+selected_journals[r]+"']").remove()}function getJournal(e){for(var l=0;l<journal_data.length;l++)if(e==journal_data[l].id)return journal_data[l];return{id:"",title:""}}var journal_data={},selected_journals=[];d3.json("/journal",function(e,l){journal_data=l,drawJournalList()});