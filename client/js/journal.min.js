function drawJournalList(){$("#journal-list option").remove();var e="";for(var l in journal_data)if(!($.inArray(l+"",selected_journals)>-1)){var t=journal_data[l],r=t.count?t.count:0;e+="<option value='"+l+"'>"+t.title+" ("+r+")</option>"}$("#journal-list").append(e)}function drawSelectedJournals(){for(var e=0;e<selected_journals.length;e++)if(!($("#journal-filter li[journal-id='"+selected_journals[e]+"']").length>0)){var l=selected_journals[e],t=journal[selected_journals[e]],r="<li class='filter-item' journal-id='"+l+"'><span class='filter-legend'       style='background-color:"+color_scale(l)+";'></span>"+t.title+" ("+t.count+")      <span class='filter-close'       onclick='removeJournalFilter(this)'>x</span></li>";$("ul#journal-filter").append(r)}$(".filter-item").on("mouseover",function(){var e=$(this).attr("journal-id"),l=d3.selectAll("svg[journal-id='"+e+"']");l.selectAll("circle").style("stroke",rgb_highlight).style("z-index",999),l.each(function(e){d3.selectAll("svg.links[doc-target='"+e.documentid+"']").selectAll("line").style("stroke",rgb_highlight).style("z-index",999),d3.selectAll("svg.links[doc-source='"+e.documentid+"']").selectAll("line").style("stroke",rgb_highlight).style("z-index",999)})}),$(".filter-item").on("mouseout",function(){var e=$(this).attr("journal-id"),l=d3.selectAll("svg[journal-id='"+e+"']");l.selectAll("circle").style("stroke",rgb_highlight).style("z-index","auto"),l.each(function(e){d3.selectAll("svg.links[doc-target='"+e.documentid+"']").selectAll("line").style("stroke",rgb_stroke).style("z-index","auto"),d3.selectAll("svg.links[doc-source='"+e.documentid+"']").selectAll("line").style("stroke",rgb_stroke).style("z-index","auto")})})}function removeJournalFilter(e){var l=$(e).parent(),t=l.attr("journal-id");l.remove(),selected_journals=selected_journals.filter(function(e){return e!=t}),applyFilters(!0)}function filterJournals(e,l){selected_journals=selected_journals.concat($("select#journal-list").val());var t=[],r=$.grep(e.documents,function(e,l){return $.inArray(e.journalid+"",selected_journals)>-1&&(-1==$.inArray(e.entityid+"",t)&&t.push(e.entityid),!0)}),a={};for(var n in t)a[t[n]]=e.entities[t[n]];for(var o={documents:r,entities:a},s=0;s<selected_journals.length;s++)$("#journal-list option[value='"+selected_journals[s]+"']").remove();if(l)return o;update(o)}function applyFilters(e){clearOverlay(),filter_data=filterJournals(map_data,!0),drawJournalList(),e&&drawSelectedJournals(),update(filter_data)}function clearOverlay(){for(;overlays.length>0;)overlays.pop().setMap(null)}function extractJournalList(e){var l=[];journal_data={};for(var t=0;t<e.length;t++){var r=e[t].journalid;l.includes(r)||(l.push(r),journal_data[r]=journal[r])}drawJournalList()}function extractAuthorList(e){var l=[];author_data={};for(var t=0;t<e.length-100;t++){var r=e[t].authorid;l.includes(r)?author_data[r].count++:(l.push(r),author_data[r]={},author_data[r].name=e[t].author,author_data[r].count=1)}}var journal={},journal_data={},author_data={},selected_journals=[];d3.json("/journal",function(e,l){journal=l});