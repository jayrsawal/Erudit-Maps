function pushInfoWidget(e){if($("#winfo-"+e.key).length>0)return!1;var t="<div class='tool-box-widget' id='winfo-"+e.key+"'>    <span class='widget-close' onclick='$(this).parent().remove();'>x</span><h2>"+e.value.title+"</h2><p>Journal: "+e.value.journal+"<br/>Author: "+e.value.author+"<br/>Year: "+e.value.year+"<br/>Period: "+e.value.period+"</p></div>";return $("#tool-box").append(t),openSideBar(),!0}function openSideBar(){+$("#tool-box").css("right").replace("px","")<0&&toggleSideBar()}function closeSideBar(){0==+$("#tool-box").css("right").replace("px","")&&toggleSideBar()}function toggleSideBar(){+$("#tool-box").css("right").replace("px","")<0?$("#tool-box").css("right",0):$("#tool-box").css("right",-$("#tool-box").width()-15)}var map=new google.maps.Map(d3.select("#map").node(),{zoom:5,minZoom:3,maxZoom:6,center:new google.maps.LatLng(55,-72),mapTypeId:google.maps.MapTypeId.TERRAIN});d3.json("stations.json",function(e,t){if(e)throw e;var o=new google.maps.OverlayView;o.onAdd=function(){var e=d3.select(this.getPanes().overlayMouseTarget).append("div").attr("class","stations"),a={};o.draw=function(){function o(e){var t,o,r,s,d;$(this).empty(),dsrc=new google.maps.LatLng(a[e.source][0],a[e.source][1]),dtrg=new google.maps.LatLng(a[e.target][0],a[e.target][1]),d1=n.fromLatLngToDivPixel(dsrc),d2=n.fromLatLngToDivPixel(dtrg),d1.y<d2.y?(t=d1.y,o=d2.y):(t=d2.y,o=d1.y),d1.x<d2.x?(r=d1.x,s=d2.x):(r=d2.x,s=d1.x),d=d3.select(this).style("left",r+l+"px").style("top",t+l+"px").style("width",s-r-l+"px").style("height",o-t-l+"px");var i,c,g,p;return d1.y<d2.y&&d1.x<d2.x||d1.x>d2.x&&d1.y>d2.y?(i=0,c=s-r,g=0,p=o-t):(d1.y<d2.y&&d1.x>d2.x||d1.x<d2.x&&d1.y>d2.y)&&(i=s-r,c=0,g=0,p=o-t),d.append("svg:line").style("stroke-width",1).style("stroke","black").attr("x1",i).attr("y1",g).attr("x2",c).attr("y2",p).attr("class","link-"+e.source).attr("id","link-"+e.source+"-"+e.target),d}function r(e){return a[e.key]=[e.value.lat,e.value.lng],e=new google.maps.LatLng(e.value.lat,e.value.lng),e=n.fromLatLngToDivPixel(e),d3.select(this).style("left",e.x-s+"px").style("top",e.y-s+"px")}var l=1,n=this.getProjection(),s=10;e.selectAll("svg").data(d3.entries(t.documents)).each(r).enter().append("svg").each(r).attr("class","marker").attr("id",function(e){return"map-node-"+e.key}).on("mouseover",function(e){d3.select(this).selectAll("circle").attr({fill:"orange",r:9})}).on("mouseout",function(e){d3.select(this).selectAll("circle").attr({fill:"brown",r:4.5})}).on("click",function(e){pushInfoWidget(e)}).append("circle").attr("r",4.5).attr("cx",s).attr("cy",s);e.selectAll(".links").data(t.links).each(o).enter().append("svg:svg").attr("class","links").each(o)}},o.setMap(map)}),$(document).ready(function(){$("#tool-box").width(.2*$(window).width())});